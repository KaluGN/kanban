"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function t(t,e){for(var n=0;n<e.length;n++){var s=e[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(e,n,s){return n&&t(e.prototype,n),s&&t(e,s),e}}(),Kanban=function(){function t(e){_classCallCheck(this,t),this.selector=e.selector,this.lanes=e.lanes,this.cards=e.cards,this.title=e.title,this.content=e.content,this.held=void 0,this.mouse={offsetX:0,offsetY:0},this.pos=void 0,this.posLane=void 0,this.html={},this.html.container=document.querySelector(this.selector),this.html.board=this.createBoard(),this.html.cards=[],this.html.ghost=document.createElement("ghost"),this.html.board.appendChild(this.html.ghost),this.html.container.appendChild(this.html.board),this.createLanes()}return _createClass(t,[{key:"addListeners",value:function(){var t=this;window.addEventListener("mouseup",function(e){t.cardUp()}),window.addEventListener("mousemove",function(e){t.cardMove(e.clientX,e.clientY)}),document.body.addEventListener("blur",function(e){t.cardUp()})}},{key:"cardDown",value:function(t){this.held=t}},{key:"cardUp",value:function(){this.held&&(this.html.ghost.style.display="none",this.held.classList.remove("held"),this.held=void 0)}},{key:"cardMove",value:function(t,e){this.html.ghost.style.transform="translateX("+t+"px) translateY("+e+"px)";var n=t+this.mouse.offsetX,s=e+this.mouse.offsetY,i=this.html.ghost.offsetWidth,l=this.html.ghost.offsetHeight;if(this.held){this.heldmoved||(this.held.classList.add("held"),this.html.ghost.innerHTML=this.held.innerHTML,this.html.ghost.style.width=this.held.offsetWidth+"px",this.html.ghost.style.left=this.mouse.offsetX+"px",this.html.ghost.style.top=this.mouse.offsetY+"px",this.html.ghost.style.display="block");var a=this.held.parentElement,o=a.getBoundingClientRect();s+l>o.top+o.height&&(a.scrollTop+=s+l-(o.top+o.height)),s<o.top&&(a.scrollTop-=o.top-s);var h=this.html.board.getBoundingClientRect();n<h.left&&(this.html.board.scrollLeft-=h.left-n),n+i>h.left+h.width&&(this.html.board.scrollLeft+=n+i-(h.left+h.width))}}},{key:"laneHide",value:function(t){t.classList.toggle("collapse")}},{key:"cardDragOver",value:function(t){if(this.held&&t!=this.held){if("lane-cards"==t.tagName.toLowerCase())return this.movedToCardAndLane||t.appendChild(this.held),this.movedToLane=!0,void(this.movedToCardAndLane=!1);this.movedToCardAndLane=t.parentElement!=this.held.parentElement,t.nextSibling==this.held||this.movedToLane||this.movedToCardAndLane?t.parentElement.insertBefore(this.held,t):t.parentElement.insertBefore(this.held,t.nextSibling),this.movedToLane=!1}}},{key:"createBoard",value:function(){return document.createElement("kanban")}},{key:"createLanes",value:function(){var t=this;this.lanes.forEach(function(e){return t.createLane(e)})}},{key:"createLane",value:function(){var t=new KanbanLane(this,lane,this.title);t.mouseEnterLane=this.dragCardToLane,this.html.board.appendChild(t.html.lane)}},{key:"createCards",value:function(){var t=this;this.cards.forEach(function(e){return t.createCard(e)})}},{key:"createCard",value:function(t){}},{key:"getLaneCardHolder",value:function(t){var e="lane[name="+t+"] lane-cards";return this.html.board.querySelector(e)}},{key:"moveCardToLane",value:function(){console.log("test")}}]),t}(),KanbanCard=function(){function t(e,n,s){_classCallCheck(this,t),this.board=e,this.content=n,this.htmlFunction=s,this.create(),this.listen()}return _createClass(t,[{key:"create",value:function(){this.html=document.createElement("card"),this.hmtl.innerHTML=this.htmlFunction(this.content)}},{key:"listen",value:function(){var t=this;this.html.addEventListener("mouseenter",function(){t.mouseenter()}),this.html.addEventListener("mousedown",function(e){var n=e.target.getBoundingClientRect(),s=t.html.getBoundingClientRect();t.board.mouse.offsetX=-e.offsetX-n.left-s.left,t.board.mouse.offsetY=-e.offsetY-n.top-s.top,t.mousedown()})}},{key:"mouseenter",value:function(){console.log("mouse enter")}},{key:"mousedown",value:function(){console.log("mousedown")}}]),t}(),KanbanLane=function(){function t(e,n,s){_classCallCheck(this,t),this.board=e,this.id=n.id,this.content=n.content,this.titleHTML=s,this.html={lane:void 0,title:void 0,cards:void 0},this.create(),this.listen()}return _createClass(t,[{key:"create",value:function(){this.html.lane=document.createElement("lane"),this.html.title=document.createElement("lane-title"),this.html.cards=document.createElement("lane-cards"),this.html.lane.id=this.id,this.html.title.innerHTML=this.titleHTML(this.content),this.html.lane.appendChild(this.html.title),this.html.lane.appendChild(this.html.cards)}},{key:"listen",value:function(){var t=this;this.html.cards.addEventListener("mouseenter",function(){t.mouseenter()}),this.html.title.addEventListener("click",function(){t.toggle()})}},{key:"mouseenter",value:function(){this.board.moveCardToLane(this)}},{key:"toggle",value:function(){this.html.lane.classList.toggle("collapse")}}]),t}();