"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function t(t,e){for(var n=0;n<e.length;n++){var a=e[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}return function(e,n,a){return n&&t(e.prototype,n),a&&t(e,a),e}}(),Kanban=function(){function t(e){_classCallCheck(this,t),this.selector=e.selector,this.lanes=e.lanes,this.cards=e.cards,this.title=e.title,this.content=e.content,this.held=void 0,this.mouse={offsetX:0,offsetY:0},this.pos=void 0,this.posLane=void 0,this.html={},this.html.container=document.querySelector(this.selector),this.html.board=this.createBoard(),this.html.cards=[],this.html.ghost=document.createElement("ghost"),this.html.board.appendChild(this.html.ghost),this.html.container.appendChild(this.html.board),this.loadLanes(),this.loadCards(),this.addListeners(),console.log("test")}return _createClass(t,[{key:"addListeners",value:function(){var t=this;window.addEventListener("mouseup",function(e){t.cardUp()}),window.addEventListener("mousemove",function(e){t.cardMove(e.clientX,e.clientY)}),document.body.addEventListener("blur",function(e){t.cardUp()})}},{key:"cardDown",value:function(t){this.held=t}},{key:"cardUp",value:function(){this.held&&(this.html.ghost.style.display="none",this.held.classList.remove("held"),this.held=void 0)}},{key:"cardMove",value:function(t,e){this.html.ghost.style.transform="translateX("+t+"px) translateY("+e+"px)";var n=t+this.mouse.offsetX,a=e+this.mouse.offsetY,i=this.html.ghost.offsetWidth,s=this.html.ghost.offsetHeight;if(this.held){this.heldmoved||(this.held.classList.add("held"),this.html.ghost.innerHTML=this.held.innerHTML,this.html.ghost.style.width=this.held.offsetWidth+"px",this.html.ghost.style.left=this.mouse.offsetX+"px",this.html.ghost.style.top=this.mouse.offsetY+"px",this.html.ghost.style.display="block");var o=this.held.parentElement,l=o.getBoundingClientRect();a+s>l.top+l.height&&(o.scrollTop+=a+s-(l.top+l.height)),a<l.top&&(o.scrollTop-=l.top-a);var r=this.html.board.getBoundingClientRect();n<r.left&&(this.html.board.scrollLeft-=r.left-n),n+i>r.left+r.width&&(this.html.board.scrollLeft+=n+i-(r.left+r.width))}}},{key:"laneHide",value:function(t){console.log(t),t.classList.toggle("collapse")}},{key:"cardDragOver",value:function(t){if(this.held&&t!=this.held){if("lane-cards"==t.tagName.toLowerCase())return this.movedToCardAndLane||t.appendChild(this.held),this.movedToLane=!0,void(this.movedToCardAndLane=!1);this.movedToCardAndLane=t.parentElement!=this.held.parentElement,t.nextSibling==this.held||this.movedToLane||this.movedToCardAndLane?t.parentElement.insertBefore(this.held,t):t.parentElement.insertBefore(this.held,t.nextSibling),this.movedToLane=!1}}},{key:"cardCreate",value:function(t){var e=document.createElement("card");e.innerHTML=this.content(t.content);var n=this;return e.addEventListener("mouseenter",function(t){n.cardDragOver(this)}),e.addEventListener("mousedown",function(t){var e=t.target.getBoundingClientRect(),a=this.getBoundingClientRect();n.mouse={offsetX:-t.offsetX-(e.left-a.left),offsetY:-t.offsetY-(e.top-a.top)},n.cardDown(this)}),e}},{key:"createLane",value:function(t){var e=document.createElement("lane"),n=document.createElement("lane-title"),a=document.createElement("lane-cards");e.setAttribute("name",t.name),n.innerHTML=this.title(t.title);var i=this;return a.addEventListener("mouseenter",function(t){i.cardDragOver(this)}),n.addEventListener("click",function(t){i.laneHide(this.parentElement)}),e.appendChild(n),e.appendChild(a),e}},{key:"createBoard",value:function(){return document.createElement("kanban")}},{key:"loadLanes",value:function(){var t=!0,e=!1,n=void 0;try{for(var a,i=this.lanes[Symbol.iterator]();!(t=(a=i.next()).done);t=!0){var s=a.value;this.html.board.appendChild(this.createLane(s))}}catch(t){e=!0,n=t}finally{try{!t&&i.return&&i.return()}finally{if(e)throw n}}}},{key:"loadCards",value:function(){var t=!0,e=!1,n=void 0;try{for(var a,i=this.cards[Symbol.iterator]();!(t=(a=i.next()).done);t=!0){var s=a.value;this.loadCard(s)}}catch(t){e=!0,n=t}finally{try{!t&&i.return&&i.return()}finally{if(e)throw n}}}},{key:"loadCard",value:function(t){var e=this.cardCreate(t);this.html.cards.push(e),this.getLaneCardHolder(t.lane).appendChild(e)}},{key:"getLaneCardHolder",value:function(t){var e="lane[name="+t+"] lane-cards";return this.html.board.querySelector(e)}}]),t}();