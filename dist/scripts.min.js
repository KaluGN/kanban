"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),KanbanBoard=function(){function t(e){_classCallCheck(this,t),this.selector=e,this.lanes=[],this.cards=[],this.heldCard=void 0,this.heldCardMoved=!1,this.html={},this.create(),this.createGhost(),this.html.container.appendChild(this.html.board),this.addListeners()}return _createClass(t,[{key:"create",value:function(){this.html.container=document.querySelector(this.selector),this.html.board=this.createBoard(),this.html.cards=[]}},{key:"createGhost",value:function(){this.ghost=new KanbanGhost,this.html.board.appendChild(this.ghost.html)}},{key:"addListeners",value:function(){var t=this;window.addEventListener("mouseup",function(e){t.mouseUp()}),window.addEventListener("mousemove",function(e){t.mouseMove(e.clientX,e.clientY)}),document.body.addEventListener("blur",function(e){t.cardUp()})}},{key:"createBoard",value:function(){return document.createElement("kanban")}},{key:"addLane",value:function(t){var e=this;this.lanes.push(t),t.onMouseEnterLane=function(t){e.mouseEnterLane(t)},this.html.board.appendChild(t.html.lane)}},{key:"addCard",value:function(t){var e=this;this.cards.push(t),t.onMouseEnter=function(t){e.mouseEnterCard(t)},t.onMouseDown=function(t,n,i){e.mouseDownOnCard(t,n,i)},this.putCardInLane(t.id,t.lane)}},{key:"findLane",value:function(t){return this.lanes.find(function(e){return e.id==t})}},{key:"findCard",value:function(t){return this.cards.find(function(e){return e.id==t})}},{key:"putCardInLane",value:function(t,e){this.findLane(e).append(this.findCard(t))}},{key:"putCardAroundCard",value:function(t,e){var n=this.findCard(t),i=this.findCard(e);n.id!=i.id&&this.findLane(i.lane).appendCardAroundCard(n,i)}},{key:"mouseEnterLane",value:function(t){this.heldCard&&this.putCardInLane(this.heldCard.id,t.id)}},{key:"mouseEnterCard",value:function(t){console.log("board knows: mouse enter card"),this.heldCard&&(console.log("Put Card above"),this.putCardAroundCard(this.heldCard.id,t.id))}},{key:"mouseDownOnCard",value:function(t,e,n){console.log("board knows: mouse down card"),this.heldCard=t,this.heldCard.grab(),this.ghost.grab(t)}},{key:"mouseUp",value:function(){console.log("board knows: mouse up"),this.heldCard.drop(),this.ghost.hide(),this.heldCard=void 0}},{key:"mouseMove",value:function(t,e){console.log("board knows: mouse move"),this.heldCard&&(this.heldCard.moved||(this.heldCard.hold(),this.ghost.show()),this.ghost.move(t,e))}},{key:"cardDragOver",value:function(t){if(this.held&&t!=this.held){if("lane-cards"==t.tagName.toLowerCase())return this.movedToCardAndLane||t.appendChild(this.held),this.movedToLane=!0,void(this.movedToCardAndLane=!1);this.movedToCardAndLane=t.parentElement!=this.held.parentElement,t.nextSibling==this.held||this.movedToLane||this.movedToCardAndLane?t.parentElement.insertBefore(this.held,t):t.parentElement.insertBefore(this.held,t.nextSibling),this.movedToLane=!1}}},{key:"scroll",value:function(){}}]),t}(),KanbanCard=function(){function t(e,n,i,s){_classCallCheck(this,t),this.id=e,this.lane=n,this.content=i,this.template=s,this.html={},this.create(),this.listen()}return _createClass(t,[{key:"create",value:function(){this.html=document.createElement("card"),this.html.innerHTML=this.template(this.content)}},{key:"listen",value:function(){var t=this;this.html.addEventListener("mouseenter",function(e){t.mouseenter(e)}),this.html.addEventListener("mousedown",function(e){t.mousedown(e)})}},{key:"grab",value:function(){this.moved=!1}},{key:"hold",value:function(){this.moved=!0,this.html.classList.add("held")}},{key:"drop",value:function(){this.html.classList.remove("held")}},{key:"mouseenter",value:function(){this.onMouseEnter(this)}},{key:"mousedown",value:function(t){var e=t.target.getBoundingClientRect(),n=this.html.getBoundingClientRect();this.grabWidth=n.width,this.grabOffsetX=-t.offsetX-(e.left-n.left),this.grabOffsetY=-t.offsetY-(e.top-n.top),this.onMouseDown(this)}}]),t}(),KanbanGhost=function(){function t(){_classCallCheck(this,t),this.x=0,this.y=0,this.width=0,this.offsetX=0,this.offsetY=0,this.display="none",this.create()}return _createClass(t,[{key:"create",value:function(){this.html=document.createElement("ghost")}},{key:"grab",value:function(t){this.html.innerHTML=t.html.innerHTML,this.width=t.grabWidth,this.offsetX=t.grabOffsetX,this.offsetY=t.grabOffsetY,this.setStyles()}},{key:"show",value:function(){this.display="block",this.setStyles()}},{key:"hide",value:function(){this.display="none",this.setStyles()}},{key:"move",value:function(t,e){this.x=t,this.y=e,this.setStyles()}},{key:"setStyles",value:function(){this.html.style.transform="translateX("+this.x+"px) translateY("+this.y+"px)",this.html.style.width=this.width+"px",this.html.style.left=this.offsetX+"px",this.html.style.top=this.offsetY+"px",this.html.style.display=this.display}}]),t}(),KanbanLane=function(){function t(e,n,i){_classCallCheck(this,t),this.id=e,this.content=n,this.template=i,this.html={lane:void 0,title:void 0,cards:void 0},this.create(),this.listen()}return _createClass(t,[{key:"create",value:function(){this.html.lane=document.createElement("lane"),this.html.title=document.createElement("lane-title"),this.html.cards=document.createElement("lane-cards"),this.html.lane.id=this.id,this.html.title.innerHTML=this.template(this.content),this.html.lane.appendChild(this.html.title),this.html.lane.appendChild(this.html.cards)}},{key:"listen",value:function(){var t=this;this.html.cards.addEventListener("mouseenter",function(){t.mouseenter()}),this.html.title.addEventListener("click",function(){t.toggle()})}},{key:"mouseenter",value:function(){this.onMouseEnterLane(this)}},{key:"toggle",value:function(){this.html.lane.classList.toggle("collapse")}},{key:"append",value:function(t){this.html.cards.appendChild(t.html),t.lane=this.id}},{key:"appendCardAroundCard",value:function(t,e){e.html.nextSibling?this.html.cards.insertBefore(t.html,e.html):this.append(t),t.lane=this.id}}]),t}();